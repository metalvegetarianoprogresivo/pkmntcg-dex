<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="theme-color" content="#0f0f14" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="description" content="Rastreador de colecciÃ³n PokÃ©mon TCG" />
  <title>PokÃ©Dex TCG</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<header>
  <div class="header-inner">
    <div class="logo">PokÃ©Dex TCG<span>COLLECTION TRACKER</span></div>
    <div class="search-wrap">
      <input type="search" id="search-input" placeholder="Buscar carta o set..." autocomplete="off" />
      <button class="search-clear" id="search-clear">âœ•</button>
    </div>
  </div>
</header>

<!-- Navigation -->
<div class="nav-tabs">
  <button class="nav-tab active" data-view="tcg">ğŸƒ ColecciÃ³n TCG</button>
  <button class="nav-tab" data-view="dex">ğŸ”´ Living Dex</button>
  <button class="nav-tab" data-view="collections">ğŸ“ Colecciones</button>
</div>

<!-- â•â•â• VIEW: TCG COLLECTION â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="view-tcg">
  <div class="toolbar">
    <div class="toolbar-inner">
      <select id="filter-series"><option value="">Todas las series</option></select>
      <label class="toggle-pocket"><input type="checkbox" id="chk-hide-pocket"><span>Ocultar Pocket</span></label>
      <div class="filter-tabs">
        <button class="filter-tab active" data-filter="all">TODAS</button>
        <button class="filter-tab" data-filter="have">TENGO</button>
        <button class="filter-tab" data-filter="missing">FALTAN</button>
      </div>
      <button class="btn accent" id="btn-export">â¬‡ Export</button>
      <button class="btn" id="btn-import">â¬† Import</button>
      <input type="file" id="import-file" accept=".json" style="display:none" />
      <button class="btn" id="btn-add-all-collection">ğŸ“ AÃ±adir filtradas a colecciÃ³n</button>
    </div>
  </div>
  <div class="stats-bar">
    <div class="stats-inner">
      <div class="stat"><div class="stat-dot have"></div><strong id="stat-have">0</strong><span>tengo</span></div>
      <div class="stat"><div class="stat-dot missing"></div><strong id="stat-missing">0</strong><span>faltan</span></div>
      <div class="stat"><div class="stat-dot total"></div><strong id="stat-total">0</strong><span>total</span></div>
      <div class="progress-bar-wrap"><div class="progress-bar-fill" id="progress-fill" style="width:0%"></div></div>
      <div class="progress-pct" id="stat-pct">0.0%</div>
    </div>
  </div>
  <div id="loading">
    <div class="pokeball"></div>
    <div class="loading-text">Cargando base de datos...</div>
  </div>
  <div class="sets-container" id="sets-container" style="display:none"></div>
  <div class="empty-state" id="empty-state" style="display:none">
    <div class="icon">ğŸ”</div><p>No se encontraron cartas con esos filtros</p>
  </div>
</div>

<!-- â•â•â• VIEW: LIVING DEX â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="view-dex">
  <div class="dex-toolbar">
    <div class="dex-toolbar-inner">
      <select id="dex-filter-gen"><option value="">Todas las generaciones</option></select>
      <div class="filter-tabs">
        <button class="filter-tab active" data-dex-filter="all">TODOS</button>
        <button class="filter-tab" data-dex-filter="registered">REGISTRADOS</button>
        <button class="filter-tab" data-dex-filter="missing">FALTAN</button>
      </div>
      <select id="dex-search-wrap" style="display:none"></select>
    </div>
  </div>
  <div class="dex-stats-bar">
    <div class="dex-stats-inner">
      <div class="stat"><div class="stat-dot have"></div><strong id="dex-stat-have">0</strong><span>registrados</span></div>
      <div class="stat"><div class="stat-dot missing"></div><strong id="dex-stat-missing">0</strong><span>faltan</span></div>
      <div class="stat"><div class="stat-dot total"></div><strong id="dex-stat-total">0</strong><span>total</span></div>
      <div class="progress-bar-wrap"><div class="progress-bar-fill" id="dex-progress-fill" style="width:0%"></div></div>
      <div class="progress-pct" id="dex-stat-pct">0.0%</div>
    </div>
  </div>
  <div class="dex-grid-container" id="dex-grid-container">
    <div class="dex-loading-bar-wrap" id="dex-loading">
      <div class="dex-loading-msg">Cargando PokÃ©dex...</div>
      <div class="dex-bar-outer"><div class="dex-bar-inner" id="dex-bar"></div></div>
      <div class="dex-bar-label" id="dex-bar-label">0 / 0</div>
    </div>
  </div>
</div>

<!-- â•â•â• VIEW: COLLECTIONS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="view-collections" style="display:none">
  <!-- Collections List -->
  <div id="coll-list-view">
    <div class="toolbar">
      <div class="toolbar-inner">
        <button class="btn accent" id="btn-new-collection">+ Nueva colecciÃ³n</button>
      </div>
    </div>
    <div class="stats-bar">
      <div class="stats-inner">
        <div class="stat"><div class="stat-dot" style="background:var(--accent)"></div><strong id="coll-stat-count">0</strong><span>colecciones</span></div>
        <div class="stat"><div class="stat-dot total"></div><strong id="coll-stat-cards">0</strong><span>cartas totales</span></div>
      </div>
    </div>
    <div class="sets-container" id="coll-list-container"></div>
    <div id="coll-empty" class="empty-state" style="display:none">ğŸ“ No tienes colecciones.<br>Crea una nueva colecciÃ³n para organizar tus cartas.</div>
  </div>
  <!-- Collection Detail -->
  <div id="coll-detail-view" style="display:none">
    <div class="toolbar">
      <div class="toolbar-inner">
        <button class="btn" id="btn-coll-back">â† Volver</button>
        <strong id="coll-detail-name" style="font-size:16px;flex:1;text-align:center;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"></strong>
        <div class="filter-tabs">
          <button class="filter-tab active" data-coll-filter="all">TODAS</button>
          <button class="filter-tab" data-coll-filter="obtained">OBTENIDAS</button>
          <button class="filter-tab" data-coll-filter="missing">BUSCANDO</button>
        </div>
      </div>
    </div>
    <div class="stats-bar">
      <div class="stats-inner">
        <div class="stat"><div class="stat-dot have"></div><strong id="coll-detail-obtained">0</strong><span>obtenidas</span></div>
        <div class="stat"><div class="stat-dot missing"></div><strong id="coll-detail-looking">0</strong><span>buscando</span></div>
        <div class="stat"><div class="stat-dot total"></div><strong id="coll-detail-total">0</strong><span>total</span></div>
        <div class="progress-bar-wrap"><div class="progress-bar-fill" id="coll-detail-progress" style="width:0%"></div></div>
        <div class="progress-pct" id="coll-detail-pct">0.0%</div>
      </div>
    </div>
    <div class="sets-container" id="coll-detail-container"></div>
    <div id="coll-detail-empty" class="empty-state" style="display:none">ğŸ” No hay cartas en esta colecciÃ³n con esos filtros.</div>
  </div>
</div>

<!-- TCG Card Modal -->
<div id="modal-overlay">
  <div class="modal">
    <img id="modal-img" src="" alt="" />
    <h3 id="modal-name"></h3>
    <p id="modal-meta"></p>
    <div class="modal-btns">
      <button class="btn-have" id="modal-btn-have">âœ“ La tengo</button>
      <button class="btn-missing" id="modal-btn-missing">âœ• Me falta</button>
    </div>
    <button class="btn-wish" id="modal-btn-wish">â˜† AÃ±adir a wishlist</button>
    <button class="btn-wish" id="modal-btn-collection" style="border-color:var(--text-dim);color:var(--text-dim)">ğŸ“ AÃ±adir a colecciÃ³n</button>
    <button class="btn-close" id="modal-close">Cerrar</button>
  </div>
</div>

<!-- Living Dex PokÃ©mon Modal -->
<div id="dex-modal-overlay">
  <div class="dex-modal">
    <div class="dex-modal-header">
      <div class="dex-modal-sprite-wrap">
        <img id="dex-modal-sprite" class="dex-modal-sprite" src="" alt="" />
      </div>
      <div class="dex-modal-info">
        <div class="dex-modal-number" id="dex-modal-number"></div>
        <div class="dex-modal-name" id="dex-modal-name"></div>
        <div class="dex-modal-types" id="dex-modal-types"></div>
        <div class="dex-modal-quick-btns">
          <button class="dex-btn-register" id="dex-btn-register">âœ“ Registrado</button>
          <button class="dex-btn-unregister" id="dex-btn-unregister">âœ• Sin registrar</button>
        </div>
      </div>
      <button class="dex-modal-close" id="dex-modal-close">âœ•</button>
    </div>
    <div class="dex-modal-cards-section">
      <div class="dex-modal-section-title">Cartas disponibles <span id="dex-modal-card-count">0</span></div>
      <div class="dex-modal-cards-scroll">
        <div class="dex-modal-cards-row" id="dex-modal-cards-row"></div>
      </div>
    </div>
  </div>
</div>

<!-- Collection Picker Modal -->
<div id="coll-picker-overlay">
  <div class="modal" style="max-width:380px">
    <h3 id="coll-picker-title">Elegir colecciÃ³n</h3>
    <div id="coll-picker-list" style="max-height:300px;overflow-y:auto;margin:12px 0"></div>
    <button class="btn accent" id="coll-picker-new" style="width:100%;margin-bottom:8px;padding:10px">+ Crear nueva colecciÃ³n</button>
    <button class="btn-close" id="coll-picker-close">Cancelar</button>
  </div>
</div>

<!-- New Collection Name Modal -->
<div id="coll-name-overlay">
  <div class="modal" style="max-width:340px">
    <h3>Nueva colecciÃ³n</h3>
    <input type="text" id="coll-name-input" placeholder="Nombre de la colecciÃ³n..." maxlength="60"
      style="width:100%;margin:12px 0;background:var(--surface2);border:1px solid var(--border);border-radius:8px;color:var(--text);font-family:'Rajdhani',sans-serif;font-size:15px;padding:10px 12px;outline:none;box-sizing:border-box" />
    <div class="modal-btns">
      <button class="btn-have" id="coll-name-confirm">Crear</button>
      <button class="btn-missing" id="coll-name-cancel">Cancelar</button>
    </div>
  </div>
</div>

<!-- Card Comment Modal -->
<div id="coll-comment-overlay">
  <div class="modal" style="max-width:340px">
    <h3>Comentario</h3>
    <p id="coll-comment-card-name" style="color:var(--text-dim);font-size:13px;margin:0"></p>
    <textarea id="coll-comment-input" rows="3" maxlength="200" placeholder="Escribe un comentario..."
      style="width:100%;margin:12px 0;background:var(--surface2);border:1px solid var(--border);border-radius:8px;color:var(--text);font-family:'Rajdhani',sans-serif;font-size:14px;padding:10px 12px;outline:none;resize:vertical;box-sizing:border-box"></textarea>
    <div class="modal-btns">
      <button class="btn-have" id="coll-comment-save">Guardar</button>
      <button class="btn-missing" id="coll-comment-cancel">Cancelar</button>
    </div>
  </div>
</div>

<div id="toast"></div>

<script src="js/state.js"></script>
<script src="js/collections.js"></script>
<script src="js/tcg.js"></script>
<script src="js/dex.js"></script>
<script src="js/app.js"></script>
</body>
</html>
